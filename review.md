Прикинул сколько займет скрипт - 67 минут Измерял через Clock::Monotonic
3250940 / 30000 * 37.1 / 60
Где 37.1 - количество секунд 
Где 30000 - количество строк
Где 3250940 - количество строк

Уменьшаю количество строк до 10 секунд
Написав тест

Добавил rspec
Добавил rspec-benchmark
Сделал фидбек луп 3 секунды
10000 строк

Замерил разницу sort & uniq от порядка
Первый поставил uniq
Убрал ненужный map

Убрал Date.parse в имплементации

Профильнул stackprof метод work
Увидел что большее занимает select
Переписал имплментацию через словари

С 10 секунд уменьшил выполенение до 1.25 секунды


Посмотрел на file_lines.each 
Оптимизировал структуру if
Добавил next
Сделал << для добавления в массив


Переделал имплементацию подсчета уникальных браузеров через set хеша и потом вынял все ключи